{"ast":null,"code":"import _classCallCheck from\"D:/finalYear/frontend/ecommerce_gui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/finalYear/frontend/ecommerce_gui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"D:/finalYear/frontend/ecommerce_gui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"D:/finalYear/frontend/ecommerce_gui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import axios from'axios';import{Button,Header,Container,Table}from'semantic-ui-react';import{connect}from\"react-redux\";import{Link,Redirect}from\"react-router-dom\";import KhaltiCheckout from\"khalti-checkout-web\";import myKey from'./khaltiKey';var ordersummary=/*#__PURE__*/function(_React$Component){_inherits(ordersummary,_React$Component);var _super=_createSuper(ordersummary);function ordersummary(){var _this;_classCallCheck(this,ordersummary);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={data:null,error:null,loading:false};_this.handleFetchOrder=function(){_this.setState({loading:true});var token=localStorage.getItem('access');var config={headers:{'Authorization':'JWT '+token}};axios.get(\"http://127.0.0.1:8000/api/fetchCart/\",config).then(function(res){_this.setState({data:res.data,loading:false});}).catch(function(err){_this.setState({error:\"You currently do not have an order\",loading:false});});};return _this;}_createClass(ordersummary,[{key:\"componentDidMount\",value:function componentDidMount(){this.handleFetchOrder();}},{key:\"render\",value:function render(){var _this$state=this.state,data=_this$state.data,error=_this$state.error,loading=_this$state.loading;console.log(data&&data.map(function(order_item){return order_item.quantity;},0).toString());var config={// replace this key with yours\n\"publicKey\":\"test_public_key_f92b8ed21efe48e1942a23d53d8de4ee\",\"productIdentity\":data&&data.map(function(order_item,i){return i;},0).toString(),\"productName\":data&&data.map(function(order_item,i){return order_item.item;},0).toString(),\"productUrl\":\"http://localhost:3000/\",\"eventHandler\":{onSuccess:function onSuccess(payload){var _this2=this;var axios=require('axios');var token=localStorage.getItem('access');var config={headers:{'Authorization':'JWT '+token}};axios.delete(\"http://127.0.0.1:8000/api/EmptyCart/\",config).then(function(res){_this2.handleFetchOrder();}).catch(function(err){console.log(error);});// hit merchant api for initiating verfication\nconsole.log(payload);var data={\"token\":payload.token,\"amount\":payload.amount};axios.get(\"https://meslaforum.herokuapp.com/khalti/\".concat(payload.token,\"/\").concat(data.amount,\"/\",\"test_secret_key_0904958fa53a470cb75213b143dfbed3\")).then(function(response){console.log(response.data);}).catch(function(error){console.log(error);});location.href=\"/\";},// onError handler is optional\nonError:function onError(error){// handle errors\nconsole.log(error);},onClose:function onClose(){console.log('widget is closing');}},\"paymentPreference\":[\"KHALTI\",\"EBANKING\",\"MOBILE_BANKING\",\"CONNECT_IPS\",\"SCT\"]};var checkout=new KhaltiCheckout(config);return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Header,null,\"Order Summary\"),data&&/*#__PURE__*/React.createElement(Table,{celled:true,inverted:true,selectable:true},/*#__PURE__*/React.createElement(Table.Header,null,/*#__PURE__*/React.createElement(Table.Row,null,/*#__PURE__*/React.createElement(Table.HeaderCell,null,\"Order number\"),/*#__PURE__*/React.createElement(Table.HeaderCell,null,\"Name\"),/*#__PURE__*/React.createElement(Table.HeaderCell,null,\"quantity\"),/*#__PURE__*/React.createElement(Table.HeaderCell,null,\"price\"),/*#__PURE__*/React.createElement(Table.HeaderCell,null,\"Gross Total\"))),/*#__PURE__*/React.createElement(Table.Body,null,data.map(function(order_item,i){return/*#__PURE__*/React.createElement(Table.Row,{key:order_item.id},/*#__PURE__*/React.createElement(Table.Cell,null,i),/*#__PURE__*/React.createElement(Table.Cell,null,order_item.item),/*#__PURE__*/React.createElement(Table.Cell,null,order_item.quantity),/*#__PURE__*/React.createElement(Table.Cell,null,order_item.item_obj.price),/*#__PURE__*/React.createElement(Table.Cell,null,order_item.total));}),/*#__PURE__*/React.createElement(Table.Row,null,/*#__PURE__*/React.createElement(Table.Cell,null),/*#__PURE__*/React.createElement(Table.Cell,null),/*#__PURE__*/React.createElement(Table.Cell,null,\"Total\"),/*#__PURE__*/React.createElement(Table.Cell,null,data.reduce(function(total,v){return total=total+v.total;},0)),/*#__PURE__*/React.createElement(Table.Cell,{textAlign:\"right\"},/*#__PURE__*/React.createElement(Button,{color:\"purple\",onClick:function onClick(){return checkout.show({amount:data.reduce(function(total,v){return total=total+v.total;},0)*100});}},\"Pay with Khalti\"))))),/*#__PURE__*/React.createElement(\"br\",null));}}]);return ordersummary;}(React.Component);export default ordersummary;","map":{"version":3,"sources":["D:/finalYear/frontend/ecommerce_gui/src/Components/order-summary.js"],"names":["React","axios","Button","Header","Container","Table","connect","Link","Redirect","KhaltiCheckout","myKey","ordersummary","state","data","error","loading","handleFetchOrder","setState","token","localStorage","getItem","config","headers","get","then","res","catch","err","console","log","map","order_item","quantity","toString","i","item","onSuccess","payload","require","delete","amount","response","location","href","onError","onClose","checkout","id","item_obj","price","total","reduce","v","show","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport axios from 'axios';\r\nimport { Button,Header,Container,Table } from 'semantic-ui-react'\r\nimport { connect } from \"react-redux\";\r\nimport { Link, Redirect } from \"react-router-dom\";\r\nimport KhaltiCheckout from \"khalti-checkout-web\";\r\nimport myKey from './khaltiKey';\r\n\r\n\r\nclass ordersummary extends React.Component {\r\n\r\n   \r\n\r\n  state = {\r\n    data: null,\r\n    error: null,\r\n    loading: false\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.handleFetchOrder();\r\n  }\r\n\r\n  handleFetchOrder = () => {\r\n    this.setState({ loading: true });\r\n    const token = localStorage.getItem('access');\r\n    const config = {\r\n      headers: {\r\n        'Authorization': 'JWT ' + token\r\n      }\r\n    };\r\n       axios.get(`http://127.0.0.1:8000/api/fetchCart/` ,config)\r\n      .then(res => {\r\n        this.setState({ data: res.data, loading: false });\r\n      })\r\n      .catch(err => {\r\n       \r\n          this.setState({\r\n            error: \"You currently do not have an order\",\r\n            loading: false\r\n          });\r\n        \r\n        \r\n      });\r\n  };\r\n\r\n\r\n  \r\n  render() {\r\n    const { data, error, loading } = this.state;\r\n    console.log(data && data.map((order_item) =>  order_item.quantity , 0 ).toString());\r\n    \r\n    let config = {\r\n      \r\n      // replace this key with yours\r\n      \"publicKey\": \"test_public_key_f92b8ed21efe48e1942a23d53d8de4ee\",\r\n      \"productIdentity\":data && data.map((order_item,i) =>  i , 0 ).toString(),\r\n      \"productName\":data && data.map((order_item,i) =>  order_item.item , 0 ).toString(),\r\n      \"productUrl\": \"http://localhost:3000/\",\r\n      \"eventHandler\": {\r\n          onSuccess (payload) {\r\n            const axios = require('axios');\r\n            const token = localStorage.getItem('access');\r\n            const config = {\r\n              headers: {\r\n                'Authorization': 'JWT ' + token\r\n              }\r\n            };\r\n              axios.delete(`http://127.0.0.1:8000/api/EmptyCart/` ,config)\r\n              .then(res => {\r\n                this.handleFetchOrder();\r\n              })\r\n              .catch(err => {\r\n               \r\n                console.log(error);\r\n                \r\n                \r\n              });\r\n              // hit merchant api for initiating verfication\r\n              console.log(payload);\r\n              \r\n\r\n                let data = {\r\n                    \"token\": payload.token,\r\n                    \"amount\": payload.amount\r\n                };\r\n\r\n               \r\n\r\n                axios.get(`https://meslaforum.herokuapp.com/khalti/${payload.token}/${data.amount}/${\"test_secret_key_0904958fa53a470cb75213b143dfbed3\"}`)\r\n                    .then(response => {\r\n                        console.log(response.data);\r\n                    })\r\n                    .catch(error => {\r\n                        console.log(error);\r\n                    });\r\n                    location.href = \"/\"\r\n\r\n          },\r\n          // onError handler is optional\r\n          onError (error) {\r\n              // handle errors\r\n              console.log(error);\r\n          },\r\n          onClose () {\r\n              console.log('widget is closing');\r\n          }\r\n      },\r\n      \"paymentPreference\": [\"KHALTI\", \"EBANKING\",\"MOBILE_BANKING\", \"CONNECT_IPS\", \"SCT\"],\r\n  };\r\n\r\n  let checkout = new KhaltiCheckout(config);\r\n\r\n    return (\r\n    <Container> \r\n      <br/>\r\n      <Header>Order Summary</Header>\r\n\r\n        {data &&\r\n        <Table celled inverted selectable>\r\n          <Table.Header>\r\n            <Table.Row>\r\n              <Table.HeaderCell>Order number</Table.HeaderCell>\r\n              <Table.HeaderCell>Name</Table.HeaderCell>\r\n              <Table.HeaderCell>quantity</Table.HeaderCell>\r\n              <Table.HeaderCell>price</Table.HeaderCell>\r\n              <Table.HeaderCell>Gross Total</Table.HeaderCell>\r\n            </Table.Row>\r\n          </Table.Header>\r\n\r\n          <Table.Body>\r\n            {data.map((order_item, i) =>{\r\n              return(\r\n                <Table.Row key= {order_item.id}>\r\n                  <Table.Cell>{i}</Table.Cell>\r\n                  <Table.Cell>{order_item.item}</Table.Cell>\r\n                  <Table.Cell >{order_item.quantity}</Table.Cell>\r\n                  <Table.Cell >{order_item.item_obj.price}</Table.Cell>\r\n                  <Table.Cell >{order_item.total}</Table.Cell>\r\n              </Table.Row>\r\n              )\r\n            })}\r\n            <Table.Row>\r\n                <Table.Cell></Table.Cell>\r\n                <Table.Cell></Table.Cell>\r\n                <Table.Cell>Total</Table.Cell>\r\n                <Table.Cell>{data.reduce((total,v) =>  total = total + v.total , 0 )}</Table.Cell>\r\n                <Table.Cell textAlign='right'>\r\n                  <Button color = 'purple' onClick={() => checkout.show({amount: data.reduce((total,v) =>  total = total + v.total , 0 )*100}) }>Pay with Khalti</Button>\r\n                </Table.Cell>\r\n              </Table.Row>\r\n          </Table.Body>\r\n        </Table>}\r\n        <br/>\r\n      </Container>\r\n      \r\n      \r\n    )\r\n  }\r\n}\r\n\r\n\r\n\r\nexport default ordersummary;\r\n"]},"metadata":{},"sourceType":"module"}